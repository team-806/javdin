# Javdin Parser - Quick Start Guide

## TL;DR (Too Long; Didn't Read)

```bash
# Build
mvn clean package

# Run
java -jar target/javdin-1.0.0.jar yourprogram.d
```

---

## Common Questions & Answers

### Q: Why does my IDE show "unresolved import" errors?

**A:** This is normal! Generated code only exists after `mvn compile`.

**Fix:**
```bash
mvn clean compile
# Then refresh your IDE
```

---

### Q: How do I run my `.d` programs?

**A:** Use the JAR file with `-jar` flag:

```bash
# CORRECT âœ“
java -jar target/javdin-1.0.0.jar myprogram.d

# WRONG âœ— (missing -jar)
java target/javdin-1.0.0.jar myprogram.d
```

---

### Q: Can I test just the parser (without running)?

**A:** Yes, use the test framework:

```java
@Test
void testMyProgram() throws Exception {
    String source = "let x = 42;";
    Lexer lexer = new Lexer(source);
    Parser parser = new Parser(lexer);
    ProgramNode ast = parser.parse();
    
    // ast is your parsed tree
    assertThat(ast).isNotNull();
}
```

---

## Essential Commands

### Build Commands

```bash
# Full build (compile + test + package)
mvn clean package

# Just compile (for IDE refresh)
mvn clean compile

# Run tests only
mvn test

# Skip tests (faster build)
mvn package -DskipTests
```

### Run Commands

```bash
# Run Javdin program
java -jar target/javdin-1.0.0.jar program.d

# Run with Maven (auto-handles classpath)
mvn exec:java -Dexec.mainClass="com.javdin.main.Main" -Dexec.args="program.d"

# Use predefined tasks (see tasks.json)
mvn -q exec:java -Dexec.mainClass=com.javdin.lexer.LexerDebug
```

---

## Understanding the Build

### What `mvn compile` does:

1. CUP generates `CupParser.java` and `Symbols.java`
   - Location: `target/generated-sources/cup/com/javdin/parser/generated/`
   - These files are NOT in `src/` (they're generated!)

2. Java compiles everything
   - Output: `target/classes/`

### What `mvn package` does:

Everything from compile, PLUS:

3. Creates **fat JAR** with all dependencies
   - Output: `target/javdin-1.0.0.jar` (~ 4 MB)
   - Includes CUP runtime, JFlex, etc.
   - Ready to run!

---

## Troubleshooting

### Problem: `NoClassDefFoundError: java_cup/runtime/Scanner`

**Cause:** Missing CUP runtime in classpath

**Solution:** Use the fat JAR instead:
```bash
java -jar target/javdin-1.0.0.jar file.d
```

---

### Problem: `Could not find or load main class target.javdin-1.0.0.jar`

**Cause:** Missing `-jar` flag

**Solution:** Add `-jar`:
```bash
java -jar target/javdin-1.0.0.jar file.d
```

---

### Problem: Parser class has no main method

**Cause:** `Parser.java` is a library, not an executable

**Solution:** Use `Main.java` instead (via JAR):
```bash
java -jar target/javdin-1.0.0.jar file.d
```

---

### Problem: IDE shows import errors after fresh clone

**Cause:** Generated code doesn't exist yet

**Solution:**
```bash
mvn clean compile
# Refresh IDE (Ctrl+Shift+P â†’ Java: Clean Java Language Server Workspace)
```

---

## File Structure

```
src/
  main/
    java/
      com/javdin/
        parser/
          Parser.java              â† Your wrapper (imports generated code)
          LexerAdapter.java        â† Bridge between Lexer and CUP
    resources/
      parser.cup                   â† CUP grammar definition

target/                            â† Generated during build (NOT in git)
  generated-sources/
    cup/
      com/javdin/parser/generated/
        CupParser.java             â† Generated by CUP
        Symbols.java               â† Generated by CUP
  classes/                         â† Compiled .class files
  javdin-1.0.0.jar                 â† Fat JAR (use this!)
  original-javdin-1.0.0.jar        â† Thin JAR (don't use)
```

---

## Quick Reference Card

| Task | Command |
|------|---------|
| Build everything | `mvn clean package` |
| Just compile | `mvn compile` |
| Run tests | `mvn test` |
| Run program | `java -jar target/javdin-1.0.0.jar file.d` |
| Clean build | `mvn clean` |
| See dependencies | `mvn dependency:tree` |
| See JAR contents | `jar tf target/javdin-1.0.0.jar` |

---

## Example Workflow

```bash
# 1. Write your .d program
echo 'let x = 42; print(x);' > test.d

# 2. Build (if not already built)
mvn clean package

# 3. Run
java -jar target/javdin-1.0.0.jar test.d
```

---

## For Presentation/Demo

### Method 1: Use Example Files

```bash
java -jar target/javdin-1.0.0.jar presentation-example-1.d
java -jar target/javdin-1.0.0.jar presentation-example-2.d
```

### Method 2: Create Custom Example

```bash
# Create file
cat > demo.d << 'EOF'
let factorial = fn(n) => {
    if (n <= 1) {
        return 1;
    } else {
        return n * factorial(n - 1);
    }
};

print(factorial(5));
EOF

# Run
java -jar target/javdin-1.0.0.jar demo.d
```

### Method 3: Show Parsing in Tests

Look at `src/test/java/com/javdin/parser/` for examples:
- `ParserTest.java` - Basic parsing
- `OperatorPrecedenceTest.java` - Operator precedence
- `ControlFlowTest.java` - If/while statements
- `FunctionLiteralTest.java` - Function literals

---

## Getting Help

- **Build issues:** Check `mvn -X compile` for verbose output
- **Runtime issues:** Check if using `java -jar` (not just `java`)
- **Import errors:** Run `mvn compile` first
- **Test failures:** See `target/surefire-reports/`

---

## Summary

**The Golden Rule:**

```bash
# To run ANY Javdin program:
mvn clean package                    # Build once
java -jar target/javdin-1.0.0.jar program.d   # Run many times
```

That's it! ðŸŽ‰
